"use strict";const ulList=document.querySelector(".js_ulList"),favsList=document.querySelector(".js_favsList"),searchBtn=document.querySelector(".js_sbtn"),favBtn=document.querySelector(".js_fbtn"),deleteFav=document.querySelector(".js_delete"),favSection=document.querySelector(".favorites"),backBtn=document.querySelector(".js_back"),pagesInfo=document.querySelector(".js_pages"),forward=document.querySelector(".js_forward"),pagination=document.querySelector(".js_pagination"),cardWarning=document.querySelector(".card-warning");let dataCharacter,dataInfo,favoritesCharacters=null!==JSON.parse(localStorage.getItem("favCharacter"))?JSON.parse(localStorage.getItem("favCharacter")):[],url="https://api.disneyapi.dev/character",pages=1;function renderListCharacter(e){ulList.innerHTML="";for(const a of e)renderCharacter(a)}function renderCharacter(e){const a=document.createElement("li"),t=document.createElement("img"),r=document.createElement("div"),s=document.createElement("h2"),c=document.createElement("a"),i=document.createElement("i");a.classList.add("card","list"),t.classList.add("card__img"),t.src=void 0===e.imageUrl||""===e.imageUrl?"https://via.placeholder.com/210x295/ffffff/555555/?text=Disney":e.imageUrl,t.alt=e.name,r.classList.add("card__separator"),s.innerText=e.name,s.classList.add("card__title"),i.classList.add("fa-regular","fa-heart","card__icon"),c.classList.add("card__fav","js_fav"),c.appendChild(i),a.appendChild(c),a.appendChild(t),a.appendChild(r),r.appendChild(s),a.appendChild(r);const n=document.createElement("p");n.classList.add("card__title"),e.tvShows.length>3?n.innerText="El psj es popular "+e.tvShows.length:n.innerText=""+e.tvShows.length,i.addEventListener("click",a=>{addFavorite(a,e)});for(let a=0;a<favoritesCharacters.length;a++)e._id===favoritesCharacters[a]._id&&i.classList.add("fa-solid");ulList.appendChild(a)}function getListCharacter(){favoritesCharacters&&renderFavourites(favoritesCharacters),fetch(url).then(e=>e.json()).then(e=>{dataCharacter=e.data,dataInfo=e.info,pagesInfo.innerText=`${pages} de ${dataInfo.totalPages}`,renderListCharacter(dataCharacter),cardWarning.classList.add("no-display")}).catch(()=>{cardWarning.classList.remove("no-display")})}function addFavorite(e,a){const t=e.target,r=favoritesCharacters.findIndex(e=>e._id===a._id);r<0?(favoritesCharacters.push(a),localStorage.setItem("favCharacter",JSON.stringify(favoritesCharacters)),t.classList.remove("fa-regular"),t.classList.add("fa-solid")):(favoritesCharacters.splice(r,1),localStorage.setItem("favCharacter",JSON.stringify(favoritesCharacters)),t.classList.remove("fa-solid"),t.classList.add("fa-regular")),renderFavourites(favoritesCharacters)}function renderFavourites(e){favsList.innerHTML="",e.forEach(e=>{const a=document.createElement("li"),t=document.createElement("img"),r=document.createElement("a"),s=document.createElement("i");a.classList.add("fav"),t.classList.add("fav__img"),t.src=""===e.imageUrl?"https://via.placeholder.com/210x295/ffffff/555555/?text=Disney":e.imageUrl,a.appendChild(t),r.classList.add("fav__delete","js_delete"),s.classList.add("fa-solid","fa-xmark","icon__delete"),r.appendChild(s),a.appendChild(r),favsList.appendChild(a),r.addEventListener("click",a=>{deleteFavorite(a,e)})}),0===favoritesCharacters.length?favSection.classList.add("no-display"):favSection.classList.remove("no-display")}function searchCharacter(e){e.preventDefault();const a=document.querySelector(".js_search").value;""===a?pagination.classList.remove("no-display"):pagination.classList.add("no-display"),fetch("https://api.disneyapi.dev/character?name="+a).then(e=>e.json()).then(e=>{renderListCharacter(e.data)})}function deleteFavorite(e,a){const t=favoritesCharacters.findIndex(e=>e._id===a._id);favoritesCharacters.splice(t,1),localStorage.setItem("favCharacter",JSON.stringify(favoritesCharacters)),renderFavourites(favoritesCharacters),renderListCharacter(dataCharacter)}function deleteListFavorites(){favoritesCharacters.splice(0,favoritesCharacters.length),localStorage.setItem("favCharacter",JSON.stringify(favoritesCharacters)),favSection.classList.add("no-display"),renderFavourites(favoritesCharacters),renderListCharacter(dataCharacter)}function favSectionClick(){favSection.classList.toggle("no-display")}function requestNewPage(e){const a=e.target.id;url=convertTohttps(dataInfo[a]),"previousPage"===a&&1!==pages?(getListCharacter(),pages--,pagesInfo.innerText=`${pages} de ${dataInfo.totalPages}`):"nextPage"===a&&(pages++,pagesInfo.innerText=`${pages} de ${dataInfo.totalPages}`,getListCharacter())}function convertTohttps(e){return e.startsWith("http://")?e.replace("http://","https://"):e}getListCharacter(),searchBtn.addEventListener("click",searchCharacter),deleteFav.addEventListener("click",deleteListFavorites),favBtn.addEventListener("click",favSectionClick),backBtn.addEventListener("click",requestNewPage),forward.addEventListener("click",requestNewPage);